#############################################################################
# Rewrite rules for translating Oregon Digital 1 URLs to Oregon Digital 2 URLs
#
# OD1:
# =============================================================================
#    Works:               /catalog/oregondigital:${id}
#    Collection:          /sets/${set_name}
#    Work in Collection:  /sets/${set_name}/oregondigital:${id}
#    Image Downloads:     /downloads/oregondigital:${id}.jpg
#                         /downloads/oregondigital-${id}.jpg
#                         /thumbnails/oregondigital:${id}.jpg
#                         /thumbnails/oregondigital-${id}.jpg
#                         /media/medium-images/*/*/oregondigital:${id}.jpg
#                         /media/medium-images/*/*/oregondigital-${id}.jpg
#                         /media/thumbnails/*/*/oregondigital:${id}.jpg
#                         /media/thumbnails/*/*/oregondigital-${id}.jpg
# OD2:
# =============================================================================
#    Works:               /concern/videos/${id} (use 'generic' to auto detect)
#    Collection:          /collections/${id}
#    Work in Collection:  N/A
#    Image Downloads:     /downloads/f0${id}?file=thumbnail (thumbnails)
#                         /downloads/f0${id}?file=jpeg (images)
#                         /downloads/f0${id}?file=mp3 (audio)
#                         /downloads/f0${id}?file=mp4 (video)
#
# NOTE: Use [:-] to Handle both 'oregondigital:${id}' and 'oregondigital-${id}' 
# for each pattern
# 
# file flag values
# =============================================================================
#    file=thumbnail: pdfs, office documents, videos, images
#    file=jpeg: images
#    file=mp3: audio
#    file=mp4: video
#
# derivative paths
# =============================================================================
#    /media/audio/*/*/oregondigital-${id}.${extension}
#    /media/video/*/*/oregondigital-${id}.${extension}
#    /media/medium-images/*/*/oregondigital-${id}.jpg
#    /media/pyramidal-tiffs/*/*/oregondigital-${id}.tiff
#    /media/thumbnails/*/*/oregondigital-${id}.jpg
#    /media/document_pages/*/*/oregondigital-${id}/normal-page-${page}.jpg
#    /media/document_pages/*/*/oregondigital-${id}/small-page-${page}.jpg
#    /media/document_pages/*/*/oregondigital-${id}/large-page-${page}.jpg
#    /media/document_pages/*/*/oregondigital-${id}/x-large-page-${page}.jpg
#    /thumbnails/oregondigital[:-]${id}.jpg
#    /downloads/oregondigital[:-]${id}.${extension}
#
# Examples:
#    audio:          df72jn000
#    video:          df70nm400
#    pyramidal-tiff: df68d7600
#    medium-images:  df68dm900
#    document_pages: 8k71pc400 (4 pages)
#
#############################################################################

# OD1 Works to OD2 Works (permanent)
rewrite ^/catalog/oregondigital:(.*)$ /concerns/images/$1 permanent;

# OD1 Works within a Set to just the Work itself
rewrite ^/sets/(.*)/oregondigital:(.*)$ /concern/images/$2 permanent;

# OD1 Sets (Collections)to OD2 Collections (permanent)
rewrite ^/sets/(.*)$ /collections/$1 permanent;

# OD1 Downloads paths to OD2 Downloads paths
# FIX: All generic downloads (/downloads/) file=thumbnail
rewrite ^/downloads/oregondigital[:-](.*).* /downloads/f0$1?file=thumbnail permanent;

# Inline thumbnails (/thumbnails/): file=thumbnail
rewrite ^/thumbnails/oregondigital[:-](.*).* /downloads/f0$1?file=thumbnail permanent;

# Medium images (/media/medium-images/): file=jpeg
rewrite ^/media/medium-images/[[:alnum:]]/[[:alnum:]]/oregondigital[:-](.*).* /downloads/f0$1?file=jpeg permanent;

# Thumbnail images (/media/thumbnails/): file=thumbnail
rewrite ^/media/thumbnails/[[:alnum:]]/[[:alnum:]]/oregondigital[:-](.*).* /downloads/f0$1?file=thumbnail permanent;

# Audio downloads (/media/audio/): file=mp3
rewrite ^/media/audio/[[:alnum:]]/[[:alnum:]]/oregondigital[:-](.*).* /downloads/f0$1?file=mp3 permanent;

# Video downloads (/media/video/): file=mp4
rewrite ^/media/video/[[:alnum:]]/[[:alnum:]]/oregondigital[:-](.*).* /downloads/f0$1?file=mp4 permanent;

#############################################################################
# Additional Rewrites
#
# These don't have a direct correlation in OD2, they'll be handled case by case
#############################################################################

# Send bookreader viewer image requests to the item's work page (images concern)
rewrite ^/media/document_pages/[[:alnum:]]/[[:alnum:]]/oregondigital-(.*)/.*  /concerns/images/$1 permanent;

# Send pyramidal tiff requests to the item's work page (images concern)
# this will affect individual image files and the ocr.html
rewrite ^/media/pyramidal-tiffs/[[:alnum:]]/[[:alnum:]]/oregondigital-(.*)/.*  /concerns/images/$1 permanent;
